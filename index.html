<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE-edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="roleengineer">
    <title>Arweave-SMT</title>

    <!-- Bootstrap -->
    <script src="https://kit.fontawesome.com/704696012e.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/arweave/bundles/web.bundle.min.js"></script>
    <style type="text/css">
      .icon-frame {
        widht: 30px;
        height: 30px;
      }

      .clickable {
        cursor: pointer;
      }

      .file-input{
  			height: 200px;
  			border: 2px dashed #62666f;
  			text-align: center;
  			display: flex;
  			align-items: center;
  			justify-content: center;
  			position: relative;
  			margin: auto;
  			max-width: 300px;
  		}

  		.file-input input[type=file]{
  			opacity: 0;
  			position: absolute;
  			background: none;
  			width: 100%;
  			height: 100%;
  		}
      output {
        display:block;
        border:5px solid #333333;
        border-radius:5px;
        min-width:25px; height:150px;
        margin:3px; padding:10px;
        text-align:center;
        background:#000000;
        color:#ffffff;
        word-wrap: break-word;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark static-top">
  		<div class="container flex">
  			<a class="navbar-brand clickable" style="color: white" id="home-icon">Arweave-SMT</a></button>
  			<span class="navbar-text" id="public-address"> <!-- shows the arweave address -->

  			</span>
  			<span class="navbar-item">
  				<button type="button" class="btn btn-success before_login" data-toggle="modal" data-target="#loginModal">Login to use service</button>
          <a type="button" class="btn btn-primary down_mm" href="https://metamask.io" style="display: none">Download MetaMask</a>
  			</span>
  		</div>
  	</nav>
    <!-- Block for login -->
    <div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="loginModal" aria-hidden="true">
  	  <div class="modal-dialog modal-dialog-centered" role="document">
  		<div class="modal-content">
  		  <div class="modal-header">
  			<h5 class="modal-title">Login using Arweave
  				<a href="https://tokens.arweave.org/#/wallet" target="_blank">
  					Get free tokens
  				</a>
  			</h5>
  			<button type="button" class="close" data-dismiss="modal" aria-label="Close">
  			  <span aria-hidden="true">&times;</span>
  			</button>
  		  </div>
  		  <div class="modal-body">
  			<div class="container">
  				<div class="row">
  					<div class="col-lg-12" style="text-align: center;">
  						<div class="file-input">
  							<input type="file" id="file" onchange="login(this.files)">
  							<div id="desc">Drop a keyfile to login</div>
  						</div>
  						<i class="fas fa-cog fa-spin login-loading-indicator" style="display: none;"></i>
  					</div>
  				</div>
  			</div>
  		  </div>
  		</div>
  	  </div>
  	</div>
    <!-- Index Page -->
    <div class="container" id="index-page">
  		<div class="row my-2">
  			<div class="col-lg-12" id="smt-info-list">
          <div class="container">
            <div class="row">
              <div class="col-lg-12">
                <br/>
                <h1 class="text-center">DEMO v2</h1>
                <h1 class="text-center">Proving web service that interacts with Demo contract</h1>
                <hr/>
                <br/>
              </div>
              <div class="col-lg-12" id="demo_description">
                <p class="before_login" style="text-indent: 20px">The general purpose of the Arweave-SMT is to allow developers to create and configurate their own proving webservice (like this one) that tracks for the chosen smart contract events and gives neccessary proofs to smart contract users. This will be implemented in the next release. <a href="https://arweave.net/7hWDZTIsxs_FHx0neiedSgAUy-yqBgt0wIBqKyrM_Zc" >See also previous one</a>.</p>
                <p style="text-indent: 20px;">The purpose of this demo is to allow users to play with one already created proving web service that interacts with one already deployed (on Ropsten network) smart contract that uses sparse merkle tree logic. The demo contract is ERC20 token that doesn't store balances, but only merkle root of all data. In this way to check the balance or transfer tokens you need to use this proving service for getting proofs and other required values.</p>
                <p class="before_login text-center">Firstly, You need to login with your arweave address. After that you'll get information about demo contract.</p>
                <p class="before_login text-center">Next, you need your MetaMask be opened and network should be switched to Ropsten Test Network.</p>

              </div>

              <!-- Block that shows after login with arweave and hides some text from index-page -->
              <div class="col-lg-12" id="contract_data" style="display: none">
                <hr>
                <h2 class="text-center">Web service is associated with the contract at address <a href="https://ropsten.etherscan.io/address/0xa92331818497318196384e802ca59681a7db898e#code">0xA92331818497318196384E802Ca59681A7Db898e</a></h2>
                <h5 class="text-center">It is a ERC20 token named Arweave SMT Example Token with total supply 21 million without decimals. It doesn't use contract storage to store balances mapping, instead that it stores only merkle root of that data and due to this service you can get necessary data to interact with it (e.g., check your balance or transfer ASET tokens to someone else).</h4>
                <h4 id="sync" class="text-center"></h4> <!-- take care about synchronizing-->
                <hr>
                <br />
                <div id="wait_mm" class="container">
                  <p class="text-center">Next, you need your MetaMask be opened and network should be switched to Ropsten Test network.</p>
                  <div class="col-lg-12 mt-5" style="text-align: center">
            				<i class="fa fa-cog fa-spin fa-3x fa-fw"></i>
            			</div>
                  <div class="col-lg-12">
                    <p class="text-center">Waiting for MetaMask...</p>
                  </div>
                </div>
                <div class="container down_mm" style="display: none">
                  <h3 class="text-center">To use application you need browser with MetaMask extension. Please Download MetaMask, use button at the top-right corner of the page to install MetaMask.</h3>
                  <p class="text-center">Next, you need your MetaMask be opened and network should be switched to Ropsten Test network.</p>
                  <div class="col-lg-12 mt-5" style="text-align: center">
            				<i class="fa fa-cog fa-spin fa-3x fa-fw"></i>
            			</div>
                  <div class="col-lg-12">
                    <p class="text-center">Waiting for MetaMask installation...</p>
                  </div>
                </div>
                <div class="container" id="lock_mm" style="display: none">
                  <h3 class="text-center">Please Login to MetaMask and accept connection request.</h3>
                  <p class="text-center">Next, you need your MetaMask be opened and network should be switched to Ropsten Test network.</p>
                  <div class="col-lg-12 mt-5" style="text-align: center">
            				<i class="fa fa-cog fa-spin fa-3x fa-fw"></i>
            			</div>
                  <div class="col-lg-12">
                    <p class="text-center">Waiting for MetaMask connection request...</p>
                  </div>
                </div>
                <div class="container" id="net_mm" style="display: none">
                  <h3 class="text-center">Please switch your network into MetaMask to 'Ropsten Test Network'.</h3>
                  <p class="text-center">This web service works only with Ropsten, so if you will choose another network it wouldn't work.</p>
                  <div class="col-lg-12 mt-5" style="text-align: center">
            				<i class="fa fa-cog fa-spin fa-3x fa-fw"></i>
            			</div>
                  <div class="col-lg-12">
                    <p class="text-center">Waiting for switching Ethereum network...</p>
                  </div>
                </div>
                <div class="container" id="cancel_mm" style="display: none">
                  <h3 class="text-center">You canceled MetaMask connection request. To use application you need to accept connection request.</h3>
                  <p class="text-center">If you want to continue use application and get new connection request, please use button below.</p>
                  <button onclick="check_metamask()" class="btn btn-primary btn-lg" style="display: table; margin:0 auto;">Repeat MetaMask connection</button>
                  <div class="col-lg-12 mt-5" style="text-align: center">
            				<i class="fa fa-cog fa-spin fa-3x fa-fw"></i>
            			</div>
                  <div class="col-lg-12">
                    <p class="text-center">Waiting for MetaMask connection request...</p>
                  </div>
                </div>
              </div>
              <!-- Block after MetaMask success and address success -->
              <div id="interact_db" class="container" style="display: none">
                <h4 class="text-center">To get 100 ASET free to play with contract click button below and confirm transaction. <span id="num_users"></span> <p style="display:none;">[key in leaves: i++]</p></h4>
                <button id="get_100_et" type="button" style="display: block; max-width: 300px; margin: auto;" class="btn btn-primary btn-lg">Get 100 ASET</button>
                <br>
                <hr>
                <h3 class="text-center" id="eth_address">Your Ethereum Address: </h3>
                <br />
                <br />
                <h3> Get data for function BalanceOf </h3>
                <p> You can use different approaches to interact with a contract. E.g., you can use your own node with your personal contract instance, REMIX, or even <a href="https://ropsten.etherscan.io/dapp/0xa92331818497318196384e802ca59681a7db898e">this new etherscan UI</a> and others.</p>
                <p> Whether approach you use, you need actual values of required parameters.</p>
                <form id="balanceOf" onsubmit="return false;" role="form">
                  <div class="form-group">
                    <div class="input-group">
                      <input id="input_bal_address" class="form-control input-lg" type="text" placeholder="Enter the address you want to get data about" pattern="0x[a-fA-F\d]+" maxlength="42" minlength="42" required>
                      </input>
                      <span class="input-group-btn">
                        <button type="submit" class="btn btn-primary btn-lg">Get data of entered address</button>
                        <button id="mm_balance" style="float: right;" type="button" class="btn btn-warning btn-lg">Get data of current MetaMask address</button>
                    </div>
                    <br />
                    <output><p id="balanceOf_text">Output field for data of chosen ethereum address </p><span id="balanceOf_output"></span></output>
                  </div>
                </form>
                <br />
                <br />
                <h3> Get data for functions Transfer or transferFrom </h3>
                <p> For usual ERC20 functions transfer or transferFrom you need three parameters sender (in transfer it skips, because sender is msg.sender), recipient and amount.</p>
                <p> For SMT you need to bring proofs for actors. </p>
                <form id="transfer_data" onsubmit="return false;" role="form">
                  <div class="form-group">
                    <div class="input-group">
                      <input id="input_sender" class="form-control input-lg" type="text" placeholder="Enter senders address here" pattern="0x[a-fA-F\d]+" maxlength="42" minlength="42" required>
                      </input>
                    </div>
                    <div class="input-group">
                      <input id="input_recipient" class="form-control input-lg" type="text" placeholder="Enter recipients address here" pattern="0x[a-fA-F\d]+" maxlength="42" minlength="42" required>
                      </input>
                    </div>
                    <div class="input-group">
                      <input id="input_amount" class="form-control input-lg" type="text" placeholder="Enter the amount that is planned to be transferred" pattern="[0-9]+" minlength="1" maxlength="78" required>
                      </input>
                    </div>
                    <div>
                      <span class="input-group-btn">
                        <button type="submit" class="btn btn-primary btn-lg" >Get data of entered parameters</button>
                    </div>
                    <br />
                    <output style="min-width:25px; height:250px;"><p id="transfer_text">Output field for data of chosen parameters </p><span id="transfer_output"></span></output>
                  </div>
                </form>
                <br />
                <br />
                <h3> DONATE</h3>
                <p>You can participate in improving this webservice. The case is to have permamently database on the Arweave network. Service fetchs data from Arweave database and new appearing data (due to new transactions on Ethereum network) from Ethereum network. Your participation is to send transaction to Arweave network with peace of a new data from Ethereum (the new data is distributed in a way that amount of donation is approximately 0.00001AR). In this way you update database with actual data and reduce webservice dependency on Ethereum network.  </p>
                <p id="press_donate"> By pressing "Donate" button you will be prompt to donate the specific amount and you will be able confirm or reject the donation.</p>
                <button id="donate" type="button" class="btn btn-success btn-lg">Donate</button>
                <br />
                <br />
              </div>
              <div class="col-lg-12 mt-5 before_login" style="text-align: center">
        				<i class="fa fa-cog fa-spin fa-3x fa-fw"></i>
        			</div>
              <div class="col-lg-12 before_login" id="loader">
                <p class="text-center">Waiting for login...</p>
              </div>
            </div>
          </div>

  			</div>
  		</div>
  		<div class="row mt-2 mb-4">
  			<div class="col-lg-12">
  				<hr>
  				<span class="clickable" data-toggle="modal" data-target="#aboutModal">About</span>
  				<span class="float-right">
  					<a href="https://www.arweave.org/" target="_blank">
  						<img class="icon-frame" src="./img/arweave.png">
  					</a>
  					<a href="https://github.com/roleengineer/arweave-smt/tree/DEMO_0.1.1" target="_blank">
  						<img class="icon-frame" src="./img/github.png">
  					</a>
  				</span>
  			</div>
  		</div>
  	</div>

    <!--About Modal -->
    <div class="modal fade" id="aboutModal" tabindex="-1" role="dialog" aria-labelledby="aboutModal" aria-hidden="true">
  	  <div class="modal-dialog modal-lg" role="document">
  	    <div class="modal-content">
  	      <div class="modal-header">
  	        <h5 class="modal-title">About</h5>
  	        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
  	          <span aria-hidden="true">&times;</span>
  	        </button>
  	      </div>
  	      <div class="modal-body">
  	      	<p class="text-center">
  	      		Arweave-SMT is a permaweb application that allows developers to create their own permaweb applications. The application that is created with Arweave-SMT is a proving webservice. It is needed when you create a smart contract that uses such data sctructure as sparse merkle tree, e.g. smart contract imports sparse merkle tree library to improve some logic. Your users need to bring proofs to interact with your contract. To solve this issue you can simply use Arweave-SMT. You customize your proving webservice to track your smart contract events and your users can use it to take neccessary proofs. Also, you can use it as a database and fetch data from it to use on your own UI built on permaweb or web2.
  	      		<br>
  	      		Powered by Arweave, this application is only for DEMO purpose!
  	      	</p>
  	      </div>
  	      <div class="modal-footer">
  	        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
  	      </div>
  	    </div>
  	  </div>
  	</div>

    <script>
  		var arweave = Arweave.init({host: 'arweave.net', port: 443, protocol: 'https'});
  	</script>
    <script src="js/login.js"></script>
    <script src="js/arweave.js"></script>
    <script src="bundle.js"></script>

  </body>

</html>
